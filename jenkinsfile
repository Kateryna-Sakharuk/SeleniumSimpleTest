pipeline {
    agent any
    environment {
        WEBDRIVER_CHROME_DRIVER = 'C:/driver/chromedriver.exe'
    }
    stages {
        stage('Checkout') {
            steps {
                git branch: 'develop_new_website', url: 'https://github.com/Kateryna-Sakharuk/SeleniumSimpleTest'
            }
        }
        stage('Run Tests') {
            steps {
                bat """
                mvn clean test ^
                -Dsuite=src/test/resources/google-failed-test-suite.xml ^
                -DbrowserName=chrome ^
                -DtestEnv=local ^
                -Dwebdriver.chrome.driver=%WEBDRIVER_CHROME_DRIVER%
                """
            }
        }
        stage('Copy Allure History') {
            steps {
                bat """
                if exist "allure-report\\history" (
                xcopy /E /I /Y "allure-report\\history" "target\\allure-results\\history"
                   )
                """

            }
        }
    }
    post {
        always {
            allure([
                includeProperties: false,
                jdk: '',
                results: [[path: 'target/allure-results']]
            ])
        }
    }
}

